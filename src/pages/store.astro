---
import { lemonSqueezySetup, listProducts } from '@lemonsqueezy/lemonsqueezy.js'
import env from '~/env'
import BaseLayout from '~/layouts/BaseLayout.astro'

lemonSqueezySetup({
  apiKey: env.LEMONSQUEEZY_API_KEY,
  onError: (error) => console.error('Error!', error),
})

const { data, error } = await listProducts()

if (error) {
  console.error('Error!', error)
}

const products = data?.data || []
---

<BaseLayout title="Store | Lemon Store">
  <h1 class="mb-8 text-center text-3xl font-bold">üçã Our Products</h1>

  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {
      products.map((product) => (
        <div class="flex flex-col justify-between rounded-2xl border border-gray-100 bg-white p-6 shadow">
          <div>
            <h2 class="mb-2 text-xl font-semibold">{product.attributes.name}</h2>
            <p class="mb-4 text-gray-600">{product.attributes.price_formatted}</p>
          </div>
          <a
            href={product.attributes.buy_now_url}
            class="inline-block rounded-xl bg-yellow-500 px-4 py-2 text-center text-white transition hover:bg-yellow-600"
            target="_blank"
            rel="noopener noreferrer"
          >
            Buy Now
          </a>
        </div>
      ))
    }
  </div>
</BaseLayout>
